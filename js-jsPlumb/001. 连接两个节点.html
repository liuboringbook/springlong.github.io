<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <title>Start jsPlumb</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.bootcss.com/jsPlumb/2.6.8/js/jsplumb.min.js"></script>
    <style>
        #diagramContainer {
            padding: 20px;
            width: 80%;
            height: 200px;
            border: 1px solid gray;
            background-image: url(http://p3alsaatj.bkt.clouddn.com/20180227163310_1bVYeW_grid.jpeg);
            background-repeat: repeat;
        }

        .item {
            position: absolute;
            height: 80px;
            width: 80px;
            border: 1px solid blue;
            float: left;
        }
    </style>
</head>
<body>
    <div id="diagramContainer">
        <div id="item_left" class="item"></div>
        <div id="item_right" class="item" style="left:150px;"></div>
    </div>

    <script>
        jsPlumb.ready(function () {
            // 很多连线都是相同设置的情况下，可以将配置抽离出来，作为一个单独的变量，作为connect的第二个参数传入。
            // 实际上connect的第二个参数会和第一个参数merge，作为一个整体。
            var commonConfig = {
                // 如果将isSource和isTarget设置成true，那么就可以用户在拖动时，自动创建连接线。
                isSource: true,
                isTarget: true,
                // 端点类型，形状（区分大小写），Rectangle-正方形，Dot-圆形，Blank-空
                endpoint: 'Dot',
                // 设置锚点位置，按照[target, source]的顺序进行设置
                // 可以有 Bottom Top Right Left四种方位
                // 还可以是BottomLeft BottomRight BottomCenter TopLeft TopRight TopCenter LeftMiddle RightMiddle的组合
                // 默认值 ['Bottom', 'Bottom']
                // anchor: ['Bottom', 'Bottom'],
                // 设置连接线的样式 Bezier-贝瑟尔曲线 Flowchart-流程图 StateMachine-弧线 Straight-直线
                connector: ['Bezier'],
                // 设置连线的样式
                paintStyle: {
                    // 设置颜色
                    stroke: '#456',
                    // 设置宽度
                    strokeWidth: 1,
                },
                // 设置鼠滑到连线上时的样式
                hoverPaintStyle: {
                    // 设置实线颜色
                    stroke: 'lightblue',
                },
                // 设置连线的箭头
                // 箭头实际上是通过设置overlays去设置的，可以设置箭头的长宽以及箭头的位置，location 0.5表示箭头位于中间，location 1表示箭头设置在连线末端。 一根连线是可以添加多个箭头的。
                overlays: [ ['Arrow', { width: 12, length: 12, location: 0.5 }] ],
                // 设置端点的样式
                endpointStyle: {
                    // 填充颜色
                    fill: '#456',
                    // 边框颜色
                    outlineStroke: 'orange',
                    // 边框宽度
                    outlineWidth: 1
                },
            }

            // 连接两个节点
            jsPlumb.connect({
                // 连线目标的标识，可以是id, element, 或者Endpoint
                target: 'item_right',
                // 连线源的标识，可以是id, element, 或者Endpoint
                source: 'item_left',
            }, commonConfig)

            // 使用draggable可以让节点被拖动
            jsPlumb.draggable('item_left', {
                // 限制节点的拖动区域
                containment: 'parent',
                // 设置网格
                grid: [10, 10],
            })
            jsPlumb.draggable('item_right', {
                containment: 'parent',
                grid: [10, 10],
            })

            // addEndpoint方法可以用来增加端点
            jsPlumb.addEndpoint('item_left', {
                anchors: ['Right']
            }, commonConfig)
            jsPlumb.addEndpoint('item_right', {
                anchors: ['Top']
            }, commonConfig)

            // 一般来说拖动创建的连接，可以再次拖动，让连接断开。如果不想触发这种行为，可以设置。
            // jsPlumb.importDefaults({
            //     ConnectionsDetachable: false
            // })

            // 请单点击一下连接线
            jsPlumb.bind('click', function (conn, originalEvent) {
                console.log(conn)
                if (window.prompt('确定删除所点击的链接吗？ 输入1确定') === '1') {
                    jsPlumb.detach(conn)
                }
            })
        })
    </script>
</body>
</html>